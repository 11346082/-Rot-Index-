<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è…çˆ›æŒ‡æ•¸ Rot Index</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon.png') }}">
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Noto Serif TC', serif;
      background: #ffffff;
      margin: 0;
      color: #111827;
    }
    a {
      text-decoration: none;
      color: inherit;
    }

    /* ---------------- NavBar ---------------- */
    .top-nav {
      position: sticky;
      top: 0;
      z-index: 40;
      background: #ffffff;
      box-shadow: 0 1px 0 rgba(15,23,42,0.06);
    }
    .top-nav-inner {
      max-width: 1120px;
      margin: 0 auto;
      padding: 14px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 24px;
      flex-wrap: nowrap;
    }
    .brand-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .brand-title {
      font-size: 20px;
      letter-spacing: 0.15em;
      font-weight: 600;
    }
    .brand-sub {
      font-size: 12px;
      color: #6b7280;
      letter-spacing: .25em;
      text-transform: uppercase;
    }

    .nav-center {
      display: flex;
      gap: 32px;
      flex: 1;
      justify-content: center;
    }
    .nav-link {
      position: relative;
      font-size: 14px;
      padding-bottom: 4px;
      cursor: pointer;
      color: #4b5563;
      white-space: nowrap;
    }
    .nav-link.active {
      color: #1d4ed8;
      font-weight: 500;
    }
    .nav-link::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      width: 0;
      height: 2px;
      background: #1d4ed8;
      transition: width .25s ease;
    }
    .nav-link.active::after {
      width: 100%;
    }
    .nav-link:hover::after {
      width: 100%;
    }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
    }
    .quote-nav-btn {
      border: none;
      border-radius: 999px;
      padding: 8px 18px;
      font-size: 13px;
      cursor: pointer;
      background: #1d4ed8;
      color: #f9fafb;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 8px 16px rgba(37, 99, 235, 0.25);
      white-space: nowrap;
      transition: all 0.18s ease;
    }
    .quote-nav-btn:hover {
      filter: brightness(1.05);
      box-shadow: 0 10px 20px rgba(37, 99, 235, 0.35);
      transform: translateY(-1px);
    }

    /* ---------------- Layout ---------------- */
    .page-wrapper {
      min-height: calc(100vh - 120px);
    }
    .page {
      display: none;
      padding: 40px 0 80px;
    }
    .page-active {
      display: block;
    }
    .container {
      max-width: 1040px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* ========== ä½ çš„åå­—å€å¡Šï¼šlabel åœ¨ä¸Šæ–¹ï¼Œä¸‹é¢ä¸€è¡Œæ’å¥½ ========== */
    .name-card-label {
      display: block;
      font-size: 14px;
      color: #4b5563;
      margin-bottom: 4px;
    }

    .name-row {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-top: 4px;
    }

    .name-row input#top-name-input {
      flex: 0 0 240px;
      max-width: 260px;
    }

    .name-btn {
      white-space: nowrap;
    }

    .name-text {
      font-size: 14px;
      text-align: right;
      color: #4b5563;
      flex: 1;
      min-width: 0;
    }

    /* ---------------- Hero / Home ---------------- */
    .hero-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 32px;
      padding-top: 40px;
      padding-bottom: 40px;
    }
    .hero-sloth {
      flex-shrink: 0;
    }
    .hero-sloth img {
      width: 110px;
      height: 110px;
      border-radius: 26px;
      object-fit: cover;
      box-shadow: 0 18px 45px rgba(15,23,42,0.24);
      background: #fefce8;
    }
    .hero-text {
      max-width: 520px;
    }
    .hero-title {
      margin: 0 0 6px;
      font-size: 30px;
      letter-spacing: 0.04em;
    }
    .hero-line {
      margin: 0;
      font-size: 14px;
      color: #4b5563;
    }
    #hero-sub {
      margin-top: 6px;
      font-size: 13px;
      color: #9ca3af;
    }

    /* å·¦å³æ¼‚æµ®æ¨¹æ‡¶ï¼šå…©é‚Šæ–¹å‘ç›¸åï¼Œä½†éƒ½ 18 ç§’ */
    .side-sloth {
      position: fixed;
      width: 110px;
      height: 110px;
      object-fit: contain;
      opacity: 0.9;
      pointer-events: none;
      z-index: 5;
      animation-duration: 18s;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
      animation-direction: alternate;
    }
    .side-sloth-left {
      left: 22px;
      animation-name: float-up-down;
    }
    .side-sloth-right {
      right: 22px;
      width: 130px;
      height: 130px;
      animation-name: float-down-up;
    }

    @keyframes float-up-down {
      from { transform: translateY(-24px); }
      to   { transform: translateY(24px); }
    }
    @keyframes float-down-up {
      from { transform: translateY(24px); }
      to   { transform: translateY(-24px); }
    }

    /* ---------------- Cards / è¡¨å–® / ä»»å‹™æ¸…å–® ---------------- */
    .card {
      background: #ffffff;
      border-radius: 18px;
      padding: 20px 22px;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.08);
      margin-bottom: 24px;
    }
    .card-title-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .card-title {
      font-size: 18px;
      margin: 0;
    }
    .card-subtitle {
      font-size: 13px;
      color: #6b7280;
      margin: 0;
    }

    label {
      display: block;
      font-size: 13px;
      color: #4b5563;
      margin-bottom: 4px;
    }
    .required-asterisk {
      color: #ef4444;
      font-size: 12px;
      margin-left: 2px;
      position: relative;
      top: -2px;
    }
    input[type="text"],
    input[type="number"],
    input[type="datetime-local"],
    select,
    textarea {
      width: 100%;
      padding: 9px 11px;
      border-radius: 12px;
      border: 1px solid #d1d5db;
      font-size: 14px;
      box-sizing: border-box;
      font-family: 'Noto Serif TC', serif;
    }
    textarea {
      min-height: 120px;
      resize: vertical;
    }
    input::placeholder,
    textarea::placeholder {
      color: #9ca3af;
    }
    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      margin-top: 6px;
      color: #4b5563;
    }

    button,
    .btn {
      border: none;
      border-radius: 999px;
      padding: 10px 20px;
      font-size: 14px;
      cursor: pointer;
      font-family: 'Noto Serif TC', serif;
      transition: all 0.18s ease;
    }

    .btn-primary {
      background: #4f46e5;
      color: #f9fafb;
    }
    .btn-secondary {
      background: #e5e7eb;
      color: #374151;
      text-decoration: none;
      display: inline-block;
    }

    .btn-info {
      background: #8aa6c4;
      color: #ffffff;
      text-decoration: none;
      display: inline-block;
    }
    .btn-warning {
      background: #d9b08c;
      color: #5b3e2b;
      text-decoration: none;
      display: inline-block;
    }

    .btn-success,
    .btn-danger {
      display: inline-block;
      border-radius: 999px;
      padding: 10px 20px;
      font-size: 14px;
      cursor: pointer;
      font-family: 'Noto Serif TC', serif;
      width: auto;
      height: auto;
    }
    .btn-success {
      background: #8fb9a5;
      color: #ffffff;
    }
    .btn-danger {
      background: #d78a8a;
      color: #ffffff;
    }

    .btn-primary:hover,
    .btn-secondary:hover,
    .btn-success:hover,
    .btn-info:hover,
    .btn-warning:hover,
    .btn-danger:hover {
      filter: brightness(1.05);
      box-shadow: 0 4px 10px rgba(15,23,42,0.18);
      transform: translateY(-1px);
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 12px;
    }
    .form-row > div {
      flex: 1;
      min-width: 220px;
    }

    /* ä»»å‹™æ¸…å–®æ¨™é¡Œ & ç¯©é¸ */
    .filter-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      margin-bottom: 10px;
      align-items: center;
    }
    .filter-label {
      font-size: 13px;
      color: #6b7280;
      margin-right: 4px;
      white-space: nowrap;
    }
    .filter-btn {
      border-radius: 999px;
      padding: 5px 12px;
      font-size: 13px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      color: #4b5563;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.18s ease;
    }
    .filter-btn.active {
      background: #6366f1;
      color: #ffffff;
      border-color: #6366f1;
    }
    .filter-btn:hover {
      filter: brightness(1.05);
      box-shadow: 0 3px 8px rgba(15,23,42,0.18);
      transform: translateY(-1px);
    }

    /* ä»»å‹™å¡ç‰‡ grid */
    .tasks-grid {
      display: grid;
      gap: 16px;
      margin-top: 8px;
    }
    .tasks-grid.three-cols {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    .tasks-grid.two-cols {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    .task-card {
      background: #ffffff;
      border-radius: 18px;
      padding: 14px 15px 12px;
      box-shadow: 0 4px 14px rgba(15, 23, 42, 0.06);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .task-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .task-title {
      font-weight: 600;
      font-size: 15px;
      word-break: break-word;
    }
    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      white-space: nowrap;
    }
    .badge-homework { background: #fee2e2; color: #b91c1c; }
    .badge-exam     { background: #dbeafe; color: #1d4ed8; }
    .badge-life     { background: #dcfce7; color: #15803d; }
    .badge-habit    { background: #f5e9ff; color: #7c3aed; }
    .badge-other    { background: #e5e7eb; color: #4b5563; }
    .deadline {
      font-size: 14px;
      color: #6b7280;
    }
    .rot-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    .rot-emoji {
      font-size: 22px;
    }
    .rot-level {
      font-size: 13px;
      color: #9ca3af;
    }
    .rot-strip {
      height: 4px;
      border-radius: 999px;
      margin-top: 4px;
    }
    .rot-fresh   { background: #bbf7d0; }
    .rot-mild    { background: #fef9c3; }
    .rot-medium  { background: #fed7aa; }
    .rot-serious { background: #fecaca; }
    .rot-critical{ background: #fca5a5; }
    .rot-dead    { background: #b91c1c; }

    .task-footer {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 2px;
    }
    .created-at-row {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 4px;
    }
    .task-footer-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .btn-row {
      display: flex;
      gap: 6px;
      flex-wrap: nowrap;
    }
    .checkin-tag {
      font-size: 13px;
      border-radius: 999px;
      padding: 5px 10px;
      display: inline-block;
      white-space: nowrap;
    }
    .checkin-done {
      color: #166534;
      background: #dcfce7;
    }
    .checkin-miss {
      color: #92400e;
      background: #fef3c7;
    }

    /* ç¯©é¸å¾Œæ²’æœ‰ä»»å‹™æ™‚çš„æç¤º */
    .tasks-empty-hint {
      margin-top: 12px;
      font-size: 13px;
      color: #9ca3af;
      text-align: center;
      display: none;
    }

    /* ---------------- æ’è¡Œæ¦œ & ç´€éŒ„åˆ—è¡¨ ---------------- */
    .rank-list {
      list-style: none;
      padding-left: 0;
      margin: 12px 0 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .rank-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 12px;
      border-radius: 999px;
      background: #f9fafb;
      font-size: 14px;
    }
    .rank-medal {
      width: 28px;
      text-align: center;
      font-size: 18px;
    }
    .rank-main {
      flex: 1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .rank-title {
      font-weight: 500;
    }
    .rank-score {
      color: #b91c1c;
      font-weight: 600;
    }

    .events-list {
      list-style: none;
      padding-left: 0;
      margin: 10px 0 0;
    }
    .event-item {
      font-size: 14px;
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }
    .event-text {
      color: #4b5563;
    }
    .event-time {
      color: #9ca3af;
      font-size: 13px;
      white-space: nowrap;
    }

    /* ---------------- å€‹äººé é¢ ---------------- */
    .personal-note {
      margin-top: 10px;
      font-size: 14px;
      color: #6b7280;
      display: none;
    }
    .profile-hint {
      font-size: 13px;
      color: #9ca3af;
      margin-top: 4px;
    }

    /* ---------------- å¿ƒéˆé›æ¹¯ Modal ---------------- */
    .quote-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 60;
    }
    .quote-backdrop.show {
      display: flex;
    }
    .quote-modal {
      background: #0f172a;
      border-radius: 20px;
      padding: 22px 24px 20px;
      width: 360px;
      max-width: 92%;
      box-shadow: 0 20px 40px rgba(15,23,42,0.6);
      color: #e5e7eb;
    }
    .quote-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .quote-title {
      font-size: 16px;
      font-weight: 600;
    }
    .quote-close {
      border: none;
      background: transparent;
      color: #9ca3af;
      font-size: 20px;
      cursor: pointer;
    }
    .quote-body {
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 10px;
    }
    .quote-meta {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 12px;
    }
    .quote-actions {
      display: flex;
      justify-content: flex-end;
    }
    .quote-next {
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 13px;
      border: none;
      cursor: pointer;
      background: #4f46e5;
      color: #f9fafb;
    }

    /* ---------------- å®Œæˆ/åˆªé™¤ Modal ---------------- */
    #done-modal-overlay,
    #delete-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 55;
    }
    .confirm-modal {
      background:#ffffff;
      border-radius: 20px;
      padding: 24px 26px;
      max-width: 360px;
      width: 90%;
      box-shadow: 0 20px 40px rgba(15,23,42,0.25);
      text-align: center;
    }
    .confirm-img {
      width: 140px;
      height: 140px;
      object-fit: contain;
      margin-bottom: 12px;
    }
    .confirm-actions {
      display:flex;
      justify-content:flex-end;
      gap:8px;
      margin-top:8px;
    }

    /* ---------------- Footer ---------------- */
    .site-footer {
      border-top: 1px solid rgba(15,23,42,0.06);
      background: #000000;
    }
    .footer-inner {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px 20px 20px;
      font-size: 13px;
      color: #e5e7eb;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    /* ================= RWDï¼šå¹³æ¿ ================= */
    @media (max-width: 1024px) {
      .container {
        max-width: 930px;
      }
      .hero-title {
        font-size: 26px;
      }
      .hero-line,
      #hero-sub {
        font-size: 13px;
      }
      .tasks-grid.three-cols {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    /* ================= RWDï¼šä¸­å°è¢å¹•ï¼ˆå¹³æ¿ç›´ç«‹ / å°ç­†é›»ï¼‰ ================= */
    @media (max-width: 900px) {
      .tasks-grid.three-cols,
      .tasks-grid.two-cols {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      .top-nav-inner {
        padding: 10px 16px;
      }
    }

    /* ================= RWDï¼šæ‰‹æ©Ÿ ================= */
    @media (max-width: 768px) {

      /* NavBarï¼šä¸Šæ’å“ç‰Œï¼Œç¬¬äºŒæ’åˆ†é ï¼Œç¬¬ä¸‰æ’å¿ƒéˆé›æ¹¯æŒ‰éˆ• */
      .top-nav-inner {
        padding: 8px 12px;
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
      }

      .brand-block {
        flex: 0 0 auto;
      }

      .nav-center {
        order: 2;
        flex: 0 0 auto;
        min-width: 0;
        display: flex;
        justify-content: flex-start;
        gap: 18px;
        overflow-x: auto;
        padding-bottom: 4px;
      }
      .nav-center::-webkit-scrollbar {
        height: 3px;
      }
      .nav-center::-webkit-scrollbar-thumb {
        background: rgba(148,163,184,0.7);
        border-radius: 999px;
      }

      .nav-right {
        order: 3;
        flex: 0 0 auto;
      }

      .quote-nav-btn {
        width: 40%;
        justify-content: center;
        padding: 6px 10px;
        font-size: 13px;
        box-shadow: 0 3px 6px rgba(37, 99, 235, 0.2);
      }

      /* Hero å€æ”¹ç›´å‘æ’ç‰ˆã€å­—å°ä¸€é» */
      .hero-wrap {
        flex-direction: column;
        text-align: center;
        padding-top: 24px;
        padding-bottom: 24px;
      }
      .hero-sloth img {
        width: 90px;
        height: 90px;
      }
      .hero-text {
        max-width: 100%;
      }
      .hero-title {
        font-size: 24px;
      }

      /* æ‰‹æ©Ÿéš±è—å·¦å³æ¨¹æ‡¶ */
      .side-sloth {
        display: none;
      }

      /* å¡ç‰‡ / è¡¨å–® æ’ç‰ˆèª¿æ•´ */
      .card {
        padding: 18px 16px;
        border-radius: 16px;
      }
      .form-row {
        gap: 10px;
        flex-direction: column;
      }
      .form-row > div {
        min-width: 100%;
      }

      /* åå­—é‚£ä¸€æ’ï¼šæ‰‹æ©Ÿæ”¹ç›´å‘æ’ */
      .name-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .name-row input#top-name-input {
        flex: 1;
        width: 100%;
        max-width: 100%;
      }
      .name-btn {
        align-self: flex-start;
      }
      .name-text {
        text-align: left;
        flex: unset;
      }

      /* ç¯©é¸åˆ—å¯ä»¥æ©«å‘æ»‘å‹• */
      .filter-row {
        flex-wrap: nowrap;
        overflow-x: auto;
        padding-bottom: 4px;
      }
      .filter-row::-webkit-scrollbar {
        height: 4px;
      }
      .filter-row::-webkit-scrollbar-thumb {
        background: rgba(148,163,184,0.7);
        border-radius: 999px;
      }

      /* ä»»å‹™å¡ï¼šä¸€æ¬„ */
      .tasks-grid.three-cols,
      .tasks-grid.two-cols {
        grid-template-columns: 1fr;
      }

      .task-footer-row {
        align-items: flex-start;
      }
      .btn-row {
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      /* å®Œæˆç´€éŒ„åˆ—è¡¨ï¼šæ‰‹æ©Ÿç‰ˆæ¯”è¼ƒå¥½è®€ */
      .event-item {
        flex-direction: column;
        align-items: flex-start;
      }
      .event-time {
        align-self: flex-end;
      }
    }

    /* ================= RWDï¼šå°æ‰‹æ©Ÿ ================= */
    @media (max-width: 480px) {
      body {
        font-size: 14px;
      }
      .brand-title {
        font-size: 18px;
      }
      .card-title {
        font-size: 17px;
      }
      .hero-title {
        font-size: 22px;
      }
      .hero-line,
      #hero-sub {
        font-size: 12px;
      }

      .btn,
      button {
        font-size: 13px;
        padding: 9px 16px;
      }
      .btn-row {
        gap: 4px;
      }
      .checkin-tag {
        font-size: 12px;
      }
      .deadline {
        font-size: 13px;
      }
      .task-title {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
<!-- å·¦å³æ¼‚æµ®æ¨¹æ‡¶ -->
<img src="{{ url_for('static', filename='img/sloth_side_left.png') }}"
     alt="side sloth left" class="side-sloth side-sloth-left">
<img src="{{ url_for('static', filename='img/sloth_side_right.png') }}"
     alt="side sloth right" class="side-sloth side-sloth-right">

<!-- NavBar -->
<header class="top-nav">
  <div class="top-nav-inner">
    <div class="brand-block">
      <div class="brand-title">è…çˆ›æŒ‡æ•¸</div>
      <div class="brand-sub">ROT INDEX</div>
    </div>

    <nav class="nav-center">
      <span class="nav-link active" data-page="home">é¦–é </span>
      <span class="nav-link" data-page="tasks">ä»»å‹™æ¸…å–®</span>
      <span class="nav-link" data-page="ranking">æ’è¡Œæ¦œ</span>
      <span class="nav-link" data-page="history">å®Œæˆç´€éŒ„</span>
      <span class="nav-link" data-page="profile">å€‹äºº</span>
    </nav>

    <div class="nav-right">
      <button id="open-quote-modal" class="quote-nav-btn">
        <span>ä¾†ç¢—å¿ƒéˆé›æ¹¯</span><span>ğŸ²</span>
      </button>
    </div>
  </div>
</header>

<div class="page-wrapper">

  <!-- --------- é¦–é  --------- -->
  <section id="page-home" class="page page-active">
    <div class="container">

      <!-- ä½¿ç”¨è€…åå­— / owner è¨­å®š -->

      <div class="card">
        <form method="post" action="{{ url_for('set_owner') }}">
          <label for="top-name-input" class="name-card-label">ä½ çš„åå­—ï¼š</label>
          <div class="name-row">
            <input
              type="text"
              id="top-name-input"
              name="owner"
              value="{{ owner or '' }}"
              placeholder="ä¾‹å¦‚ï¼šæŸ¯æŸ¯ã€é˜¿åœŸã€ç†¬å¤œå°å¤©æ‰">
            
            <button type="submit"
                    id="set-user-btn"
                    class="btn-primary name-btn">
              åˆ‡æ› / è¨­å®šä½¿ç”¨è€…
            </button>

            <span id="current-user-label" class="name-text">
              ç›®å‰ä½¿ç”¨è€…ï¼š
              <span data-display-name>{{ owner or 'æœ‹å‹' }}</span>
              Â· ä¸‹é¢æ¸…å–®éƒ½æ˜¯ä½ çš„å°ˆå±¬ä»»å‹™ ğŸ¿
            </span>
          </div>
        </form>
      </div>
      <div class="hero-wrap">
        <div class="hero-sloth">
          <img id="hero-sloth-img"
               src="{{ url_for('static', filename='img/logo_idle.png') }}"
               data-hover="{{ url_for('static', filename='img/logo_wave.png') }}"
               alt="æ¨¹æ‡¶ç›£ç£å“¡">
        </div>
        <div class="hero-text">
          <h1 class="hero-title">æ¥ä½ä½ æ¯ä¸€æ¬¡çš„æ‹–å»¶</h1>
          <p class="hero-line">
            è®“ä½ çš„ä½œæ¥­ã€è€ƒè©¦ã€ç”Ÿæ´»å¾…è¾¦ï¼Œä¸€é»ä¸€æ»´ã€Œç™¼é…µã€çµ¦ä½ çœ‹ã€‚
          </p>
          <p id="hero-sub">
            æ¨¹æ‡¶ç›£ç£å“¡ä»Šå¤©æœƒé»˜é»˜ç›¯è‘—ä½ å–”ã€‚
          </p>
        </div>
      </div>

      <!-- æ–°å¢ä»»å‹™ -->
      <div class="card">
        <div class="card-title-row">
          <h2 class="card-title">æ–°å¢å¾…è¾¦äº‹é … âœï¸</h2>
        </div>
        <p class="card-subtitle">
          å…ˆæŠŠäº‹æƒ…ä¸Ÿé€²æ¸…å–®è£¡ï¼Œä¹‹å¾Œæ…¢æ…¢ã€Œç™¼é…µã€æˆä¸€å€‹å€‹æˆæœã€‚
        </p>

        <form method="post" action="{{ url_for('add_task') }}">
          <div class="form-row">
            <div>
              <label for="title">
                ä»»å‹™å…§å®¹<span class="required-asterisk">*</span>
              </label>
              <input type="text" id="title" name="title" required
                     placeholder="ä¾‹å¦‚ï¼šç¬¬ 3 å–®å…ƒè‹±æ–‡å–®å­—ã€é›¢æ•£ä½œæ¥­ã€æ´—è¡£æœ">
            </div>
          </div>
          <div class="form-row">
            <div>
              <label for="category">
                åˆ†é¡<span class="required-asterisk">*</span>
              </label>
              <select id="category" name="category" required>
                <option value="homework">ä½œæ¥­ ğŸ“š</option>
                <option value="exam">è€ƒè©¦ ğŸ“</option>
                <option value="life">ç”Ÿæ´» ğŸŒ¿</option>
                <option value="habit">ç¿’æ…£ / æ¯å¤©éƒ½è¦åš ğŸ”</option>
                <option value="other">å…¶ä»– ğŸŒ€</option>
              </select>
            </div>
            <div>
              <label for="deadline">æˆªæ­¢æ™‚é–“ï¼ˆå¯é¸ï¼‰</label>
              <input type="datetime-local" id="deadline" name="deadline">
            </div>
            <div>
              <label for="interval_days">ï¼ˆç„¡æœŸé™ï¼‰å¹¾å¤©è¦åšä¸€æ¬¡</label>
              <input type="number" id="interval_days" name="interval_days"
                     placeholder="ä¾‹å¦‚ 1 æˆ– 3" min="1" max="30">
              <div class="checkbox-row">
                <input type="checkbox" id="no_deadline" name="no_deadline">
                <label for="no_deadline">é€™æ˜¯ç„¡æœŸé™ / ç¿’æ…£å‹ä»»å‹™</label>
              </div>
              <div style="font-size:11px;color:#9ca3af;margin-top:3px;">
                åªå°ã€Œç„¡æœŸé™ / ç¿’æ…£å‹ã€æœ‰ä½œç”¨ï¼Œæ²’å¡«é è¨­ç‚º 1 å¤©ã€‚
              </div>
            </div>
            <div>
              <label for="initial_rot">
                ä¸€é–‹å§‹çš„è…çˆ›åº¦<span class="required-asterisk">*</span>
              </label>
              <select id="initial_rot" name="initial_rot" required>
                <option value="0">0 - å®Œå…¨æ–°é®® ğŸ€</option>
                <option value="30">30 - æœ‰é»åœ¨æ„ ğŸŒ±</option>
                <option value="50">50 - æœ‰å£“åŠ›äº† â°</option>
                <option value="70">70 - é–‹å§‹è‡­è‡­äº† ğŸ”¥</option>
                <option value="90">90 - å¾ˆç³Ÿç³• ğŸ’¢</option>
                <option value="99">99 - å¯ä»¥è¾¦é ­ä¸ƒ ğŸš¨</option>
              </select>
            </div>
          </div>
          <div style="margin-top: 10px; text-align: right;">
            <button type="submit" class="btn-primary">æ–°å¢ä»»å‹™ âœ¨</button>
          </div>
        </form>
      </div>

      <!-- ä»»å‹™æ¸…å–®ï¼ˆé¦–é ï¼‰ -->
      {% if tasks %}
      <div class="card">
        <div class="card-title-row">
          <h2 class="card-title">ä»»å‹™æ¸…å–® ğŸ“</h2>
        </div>
        <p class="card-subtitle">ç”¨åˆ†é¡å¿«é€Ÿæ‰¾åˆ°ä½ ç¾åœ¨æƒ³è™•ç†çš„ä»»å‹™ã€‚</p>

        <div class="filter-row">
          <span class="filter-label">ç¯©é¸åˆ†é¡ï¼š</span>
          <button type="button" class="filter-btn active" data-filter="all">
            å…¨éƒ¨ ({{ total_tasks }})
          </button>
          <button type="button" class="filter-btn" data-filter="homework">
            ä½œæ¥­ ğŸ“š ({{ category_counts.get('homework', 0) }})
          </button>
          <button type="button" class="filter-btn" data-filter="exam">
            è€ƒè©¦ ğŸ“ ({{ category_counts.get('exam', 0) }})
          </button>
          <button type="button" class="filter-btn" data-filter="life">
            ç”Ÿæ´» ğŸŒ¿ ({{ category_counts.get('life', 0) }})
          </button>
          <button type="button" class="filter-btn" data-filter="habit">
            å­¸ç¿’ / ç¿’æ…£ ğŸ” ({{ category_counts.get('habit', 0) }})
          </button>
          <button type="button" class="filter-btn" data-filter="other">
            å…¶ä»– ğŸŒ€ ({{ category_counts.get('other', 0) }})
          </button>
        </div>

        <div class="tasks-grid three-cols">
          {% for task in tasks %}
          <div class="task-card" data-category="{{ task.category }}">
            <div class="task-header">
              <div class="task-title">{{ task.title }}</div>
              <div class="badge
                {% if task.category == 'homework' %}badge-homework
                {% elif task.category == 'exam' %}badge-exam
                {% elif task.category == 'life' %}badge-life
                {% elif task.category == 'habit' %}badge-habit
                {% else %}badge-other{% endif %}">
                {% if task.category == "homework" %}ä½œæ¥­ ğŸ“š
                {% elif task.category == "exam" %}è€ƒè©¦ ğŸ“
                {% elif task.category == "life" %}ç”Ÿæ´» ğŸŒ¿
                {% elif task.category == "habit" %}ç¿’æ…£ ğŸ”
                {% else %}å…¶ä»– ğŸŒ€{% endif %}
              </div>
            </div>

            <div class="deadline">
              â±ï¸ {{ task.deadline_str }}
              {% if task.is_routine and task.interval_days %}
              ï½œ æ¯ {{ task.interval_days }} å¤©è¦åšä¸€æ¬¡
              {% endif %}
            </div>

            <div class="rot-row">
              <div class="rot-emoji">{{ task.rot_emoji }}</div>
              <div>
                <div>{{ task.rot_message }}</div>
                <div class="rot-level">
                  è…çˆ›åº¦ï¼š{{ task.rot_level }}
                  {% if task.initial_rot %}
                  ï¼ˆèµ·å§‹ {{ task.initial_rot }}ï¼‰
                  {% endif %}
                </div>
              </div>
            </div>
            <div class="rot-strip rot-{{ task.rot_bucket }}"></div>

            <div class="task-footer">
              <div class="created-at-row">
                å»ºç«‹æ–¼ï¼š{{ task.created_at }}
              </div>

              <div class="task-footer-row">
                <div></div>
                <div class="btn-row">
                  <a href="{{ url_for('edit_task', task_id=task.id) }}" class="btn btn-warning">ä¿®æ”¹</a>
                  <a href="{{ url_for('checkin_task', task_id=task.id) }}" class="btn btn-info">æ‰“å¡</a>
                  <a href="{{ url_for('view_task_checkins_by_task', task_id=task.id) }}" class="btn btn-secondary">ç´€éŒ„</a>
                </div>
              </div>

              <div class="task-footer-row">
                <div>
                  {% if task.checked_today %}
                  <div class="checkin-tag checkin-done">ä»Šæ—¥å·²æ‰“å¡ âœ…</div>
                  {% else %}
                  <div class="checkin-tag checkin-miss">ä»Šæ—¥æœªæ‰“å¡ âš ï¸</div>
                  {% endif %}
                </div>
                <div class="btn-row">
                  <form method="post" action="{{ url_for('done_task', task_id=task.id) }}"
                        style="display:inline;" class="done-form" data-title="{{ task.title }}">
                    <button type="submit" class="btn btn-success">å®Œæˆ</button>
                  </form>
                  <form method="post" action="{{ url_for('delete_task', task_id=task.id) }}"
                        class="delete-form" data-title="{{ task.title }}" style="display:inline;">
                    <button type="submit" class="btn btn-danger">åˆªé™¤</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        <div class="tasks-empty-hint">
          ç›®å‰é€™å€‹åˆ†é¡é‚„æ²’æœ‰ä»»å‹™ï¼Œå…ˆåœ¨ä¸Šé¢æ–°å¢ä¸€å€‹è©¦è©¦ âœï¸
        </div>
      </div>
      {% else %}
      <div class="card" style="text-align:center;color:#9ca3af;">
        ç›®å‰é‚„æ²’æœ‰ä»»å‹™ï¼Œè¦ä¸è¦å…ˆåŠ ä¸€å€‹ã€Œä»Šå¤©èƒŒ 20 å€‹å–®å­—ã€ï¼ŸğŸ“š
      </div>
      {% endif %}
    </div>
  </section>

  <!-- --------- ä»»å‹™æ¸…å–®é  --------- -->
  <section id="page-tasks" class="page">
    <div class="container">
      {% if tasks %}
      <div class="card">
        <div class="card-title-row">
          <h2 class="card-title">ä»»å‹™æ¸…å–® ğŸ“</h2>
        </div>
        <p class="card-subtitle">ç”¨åˆ†é¡å¿«é€Ÿæ‰¾åˆ°ä½ ç¾åœ¨æƒ³è™•ç†çš„ä»»å‹™ã€‚</p>

        <div class="filter-row">
          <span class="filter-label">ç¯©é¸åˆ†é¡ï¼š</span>
          <button type="button" class="filter-btn active" data-filter="all">
            å…¨éƒ¨ ({{ total_tasks }})
          </button>
          <button type="button" class="filter-btn" data-filter="homework">
            ä½œæ¥­ ğŸ“š ({{ category_counts.get('homework', 0) }})
          </button>
          <button type="button" class="filter-btn" data-filter="exam">
            è€ƒè©¦ ğŸ“ ({{ category_counts.get('exam', 0) }})
          </button>
          <button type="button" class="filter-btn" data-filter="life">
            ç”Ÿæ´» ğŸŒ¿ ({{ category_counts.get('life', 0) }})
          </button>
          <button type="button" class="filter-btn" data-filter="habit">
            å­¸ç¿’ / ç¿’æ…£ ğŸ” ({{ category_counts.get('habit', 0) }})
          </button>
          <button type="button" class="filter-btn" data-filter="other">
            å…¶ä»– ğŸŒ€ ({{ category_counts.get('other', 0) }})
          </button>
        </div>

        <div class="tasks-grid three-cols">
          {% for task in tasks %}
          <div class="task-card" data-category="{{ task.category }}">
            <div class="task-header">
              <div class="task-title">{{ task.title }}</div>
              <div class="badge
                {% if task.category == 'homework' %}badge-homework
                {% elif task.category == 'exam' %}badge-exam
                {% elif task.category == 'life' %}badge-life
                {% elif task.category == 'habit' %}badge-habit
                {% else %}badge-other{% endif %}">
                {% if task.category == "homework" %}ä½œæ¥­ ğŸ“š
                {% elif task.category == "exam" %}è€ƒè©¦ ğŸ“
                {% elif task.category == "life" %}ç”Ÿæ´» ğŸŒ¿
                {% elif task.category == "habit" %}ç¿’æ…£ ğŸ”
                {% else %}å…¶ä»– ğŸŒ€{% endif %}
              </div>
            </div>

            <div class="deadline">
              â±ï¸ {{ task.deadline_str }}
              {% if task.is_routine and task.interval_days %}
              ï½œ æ¯ {{ task.interval_days }} å¤©è¦åšä¸€æ¬¡
              {% endif %}
            </div>

            <div class="rot-row">
              <div class="rot-emoji">{{ task.rot_emoji }}</div>
              <div>
                <div>{{ task.rot_message }}</div>
                <div class="rot-level">
                  è…çˆ›åº¦ï¼š{{ task.rot_level }}
                  {% if task.initial_rot %}
                  ï¼ˆèµ·å§‹ {{ task.initial_rot }}ï¼‰
                  {% endif %}
                </div>
              </div>
            </div>
            <div class="rot-strip rot-{{ task.rot_bucket }}"></div>

            <div class="task-footer">
              <div class="created-at-row">
                å»ºç«‹æ–¼ï¼š{{ task.created_at }}
              </div>

              <div class="task-footer-row">
                <div></div>
                <div class="btn-row">
                  <a href="{{ url_for('edit_task', task_id=task.id) }}" class="btn btn-warning">ä¿®æ”¹</a>
                  <a href="{{ url_for('checkin_task', task_id=task.id) }}" class="btn btn-info">æ‰“å¡</a>
                  <a href="{{ url_for('view_task_checkins_by_task', task_id=task.id) }}" class="btn btn-secondary">ç´€éŒ„</a>
                </div>
              </div>

              <div class="task-footer-row">
                <div>
                  {% if task.checked_today %}
                  <div class="checkin-tag checkin-done">ä»Šæ—¥å·²æ‰“å¡ âœ…</div>
                  {% else %}
                  <div class="checkin-tag checkin-miss">ä»Šæ—¥æœªæ‰“å¡ âš ï¸</div>
                  {% endif %}
                </div>
                <div class="btn-row">
                  <form method="post" action="{{ url_for('done_task', task_id=task.id) }}"
                        style="display:inline;" class="done-form" data-title="{{ task.title }}">
                    <button type="submit" class="btn btn-success">å®Œæˆ</button>
                  </form>
                  <form method="post" action="{{ url_for('delete_task', task_id=task.id) }}"
                        class="delete-form" data-title="{{ task.title }}" style="display:inline;">
                    <button type="submit" class="btn btn-danger">åˆªé™¤</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        <div class="tasks-empty-hint">
          ç›®å‰é€™å€‹åˆ†é¡é‚„æ²’æœ‰ä»»å‹™ï¼Œå…ˆåœ¨ä¸Šé¢æ–°å¢ä¸€å€‹è©¦è©¦ âœï¸
        </div>
      </div>
      {% else %}
      <div class="card" style="text-align:center;color:#9ca3af;">
        ç›®å‰é‚„æ²’æœ‰ä»»å‹™ï¼Œè¦ä¸è¦å…ˆåŠ ä¸€å€‹ã€Œä»Šå¤©èƒŒ 20 å€‹å–®å­—ã€ï¼ŸğŸ“š
      </div>
      {% endif %}
    </div>
  </section>

  <!-- --------- æ’è¡Œæ¦œé  --------- -->
  <section id="page-ranking" class="page">
    <div class="container">
      {% if top_rot_tasks %}
      <div class="card">
        <div class="card-title-row">
          <h2 class="card-title">æœ€è‡­ä»»å‹™æ’è¡Œæ¦œ ğŸ†</h2>
        </div>
        <p class="card-subtitle">ä¾ç…§ç›®å‰è…çˆ›åº¦ç”±é«˜åˆ°ä½æ’åºã€‚</p>
        <ol class="rank-list">
          {% for t in top_rot_tasks %}
          <li class="rank-item">
            <div class="rank-medal">
              {% if loop.index == 1 %}ğŸ¥‡
              {% elif loop.index == 2 %}ğŸ¥ˆ
              {% elif loop.index == 3 %}ğŸ¥‰
              {% else %}{{ loop.index }}{% endif %}
            </div>
            <div class="rank-main">
              <div class="rank-title">{{ t.title }}</div>
              <div class="rank-score">è…çˆ›åº¦ {{ t.rot_level }}</div>
            </div>
          </li>
          {% endfor %}
        </ol>
      </div>
      {% else %}
      <div class="card" style="text-align:center;color:#9ca3af;">
        é‚„æ²’æœ‰ä»»ä½•ä»»å‹™å¯ä»¥æ’åï¼Œå…ˆå»æ–°å¢å¹¾å€‹å§ï¼ğŸŒ±
      </div>
      {% endif %}
    </div>
  </section>

  <!-- --------- å®Œæˆç´€éŒ„é  --------- -->
  <section id="page-history" class="page">
    <div class="container">
      {% if events %}
      <div class="card">
        <div class="card-title-row">
          <h2 class="card-title">æœ€è¿‘æ“ä½œç´€éŒ„ ğŸ“œ</h2>
        </div>
        <p class="card-subtitle">å¾ Redis Streams è®€å‡ºæœ€è¿‘ 10 ç­†ã€Œæ–°å¢ / ä¿®æ”¹ / åˆªé™¤ / æ‰“å¡ã€ã€‚</p>
        <ul class="events-list">
          {% for e in events %}
          <li class="event-item">
            <span class="event-text">{{ e.text }}</span>
            <span class="event-time">{{ e.time_str }}</span>
          </li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}

      {% if done_events %}
      <div class="card">
        <div class="card-title-row">
          <h2 class="card-title">å®Œæˆä»»å‹™ç´€éŒ„ âœ…</h2>
        </div>
        <p class="card-subtitle">æœ€è¿‘ 10 ç­†å·²å®Œæˆçš„ä»»å‹™ï¼ˆæŒ‰ã€Œå®Œæˆã€æ™‚è¨˜éŒ„ï¼‰ã€‚</p>
        <ul class="events-list">
          {% for e in done_events %}
          <li class="event-item">
            <span class="event-text">{{ e.text }}</span>
            <span class="event-time">{{ e.time_str }}</span>
          </li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}
    </div>
  </section>

  <!-- --------- å€‹äººé é¢ --------- -->
  <section id="page-profile" class="page">
    <div class="container">
      <div class="card">
        <div class="card-title-row">
          <h2 class="card-title">å—¨ï¼Œ<span data-display-name>æœ‹å‹</span>ï¼</h2>
        </div>
        <p class="card-subtitle">
          å¾ä»Šå¤©é–‹å§‹ï¼Œæ¨¹æ‡¶ç›£ç£å“¡æœƒå®è‘—ä½ çš„è…çˆ›æŒ‡æ•¸ã€‚
        </p>
        <p class="profile-hint">
          å°æé†’ï¼šé€™å€‹åå­—åªæœƒå­˜åœ¨é€™å°è£ç½®è£¡ï¼Œæ›é›»è…¦æˆ–æ¸…é™¤ç€è¦½è³‡æ–™å°±æœƒè¢«é‡ç½®ã€‚
        </p>

        <div class="form-row" style="margin-top:16px;">
          <div style="flex:1;">
            <label for="profile-name-input">ä½ çš„åå­—</label>
            <input type="text" id="profile-name-input" placeholder="ä¾‹å¦‚ï¼šæŸ¯æŸ¯ã€é˜¿åœŸã€ç†¬å¤œå°å¤©æ‰">
          </div>
          <div style="flex:0 0 auto;display:flex;align-items:flex-end;">
            <button id="save-name-btn" class="btn-primary">å„²å­˜</button>
          </div>
        </div>

        <p class="personal-note">
          ç¾åœ¨ç´€éŒ„çš„åå­—æ˜¯ï¼š
          <span data-display-name>æœ‹å‹</span> Â· æ¨¹æ‡¶ç›£ç£å“¡ä»Šå¤©æœƒé»˜é»˜ç›¯è‘—ä½ å–”ã€‚
        </p>
      </div>
    </div>
  </section>

</div>

<!-- Footer -->
<footer class="site-footer">
  <div class="footer-inner">
    <span>è…çˆ›æŒ‡æ•¸ Rot Index Â· 2025</span>
    <span>æ…¢ä¸€é»åšæ²’é—œä¿‚ï¼Œä½†åˆ¥å¿˜äº†é–‹å§‹ã€‚</span>
  </div>
</footer>

<!-- å¿ƒéˆé›æ¹¯ Modal -->
<div class="quote-backdrop" id="quote-backdrop">
  <div class="quote-modal">
    <div class="quote-header">
      <div class="quote-title">è…çˆ›å¿ƒéˆé›æ¹¯ Â· BETA</div>
      <button class="quote-close" id="quote-close">&times;</button>
    </div>
    <div class="quote-body" id="quote-text"></div>
    <div class="quote-meta">
      ä¾†è‡ªï¼šè…çˆ›æŒ‡æ•¸ Rot Index Â· æ¨¹æ‡¶ç›£ç£å“¡
    </div>
    <div class="quote-actions">
      <button class="quote-next" id="quote-next">å†ä¾†ä¸€ç¢— ğŸ¥£</button>
    </div>
  </div>
</div>

<!-- å®Œæˆä»»å‹™ Modal -->
<div id="done-modal-overlay">
  <div class="confirm-modal">
    <img src="{{ url_for('static', filename='img/sloth_congrats.png') }}"
         alt="æ¨¹æ‡¶ç‚ºä½ é¼“æŒ" class="confirm-img">
    <h2 style="margin:0 0 6px;font-size:20px;">çœŸçš„è¦å®Œæˆé€™å€‹ä»»å‹™å—ï¼Ÿ</h2>
    <p id="done-modal-text" style="margin:0 0 16px;font-size:14px;color:#6b7280;">
      æ¨¹æ‡¶æ­£åœ¨ç‚ºä½ é¼“æŒï¼Œç¢ºèªä¹‹å¾Œå°±æŠŠå®ƒå¾æ¸…å–®ç§»åˆ°ã€Œå®Œæˆä»»å‹™ç´€éŒ„ã€å–”ï¼
    </p>
    <div class="confirm-actions">
      <button type="button" id="done-cancel-btn" class="btn-secondary">å…ˆç­‰ç­‰</button>
      <button type="button" id="done-confirm-btn" class="btn btn-success">æˆ‘å®Œæˆäº† ğŸ¥³</button>
    </div>
  </div>
</div>

<!-- åˆªé™¤ä»»å‹™ Modal -->
<div id="delete-modal-overlay">
  <div class="confirm-modal">
    <img src="{{ url_for('static', filename='img/sloth_delete.png') }}"
         alt="æ¨¹æ‡¶ç–‘æƒ‘åœ°çœ‹è‘—ä½ " class="confirm-img">
    <h2 style="margin:0 0 6px;font-size:20px;">çœŸçš„è¦åˆªé™¤é€™å€‹ä»»å‹™å—ï¼Ÿ</h2>
    <p id="delete-modal-text" style="margin:0 0 16px;font-size:14px;color:#6b7280;">
      åˆªé™¤ä¹‹å¾Œå°±ä¸æœƒå†å‡ºç¾åœ¨æ¸…å–®è£¡äº†ï¼ˆå®Œæˆç´€éŒ„ä¹Ÿä¸æœƒæœ‰å–”ï¼‰ã€‚
    </p>
    <div class="confirm-actions">
      <button type="button" id="delete-cancel-btn" class="btn-secondary">æˆ‘å†æƒ³æƒ³</button>
      <button type="button" id="delete-confirm-btn" class="btn btn-danger">é‚„æ˜¯åˆªæ‰å¥½äº† ğŸ˜µ</button>
    </div>
  </div>
</div>

<script>
  // ---------- Page åˆ‡æ› ----------
  const navLinks = document.querySelectorAll('.nav-link');
  const pages = document.querySelectorAll('.page');

  navLinks.forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const pageName = link.dataset.page;
      pages.forEach(p => p.classList.remove('page-active'));
      document.getElementById('page-' + pageName).classList.add('page-active');

      navLinks.forEach(l => l.classList.remove('active'));
      link.classList.add('active');

      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  });

  // ---------- å·¦å³æ¼‚æµ®æ¨¹æ‡¶ top éš¨æ©Ÿ ----------
  document.querySelectorAll('.side-sloth').forEach(el => {
    const min = 18, max = 70;
    const top = min + Math.random() * (max - min);
    el.style.top = top + 'vh';
  });

  // ---------- ä¸­å¤®æ¨¹æ‡¶ hover æ›åœ– ----------
  const heroSloth = document.getElementById('hero-sloth-img');
  if (heroSloth) {
    const idleSrc = heroSloth.getAttribute('src');
    const hoverSrc = heroSloth.dataset.hover;
    heroSloth.addEventListener('mouseenter', () => {
      if (hoverSrc) heroSloth.src = hoverSrc;
    });
    heroSloth.addEventListener('mouseleave', () => {
      heroSloth.src = idleSrc;
    });
  }

  // ---------- æ–°å¢ä»»å‹™ï¼šæˆªæ­¢æ™‚é–“ / ç„¡æœŸé™ ----------
  const noDeadlineCheckbox = document.getElementById('no_deadline');
  const deadlineInput = document.getElementById('deadline');
  const intervalInput = document.getElementById('interval_days');

  function updateDeadlineState() {
    if (!noDeadlineCheckbox || !deadlineInput || !intervalInput) return;
    const hasDeadline = deadlineInput.value !== "";
    if (hasDeadline) {
      noDeadlineCheckbox.checked = false;
      noDeadlineCheckbox.disabled = true;
      intervalInput.value = "";
      intervalInput.disabled = true;
      deadlineInput.disabled = false;
    } else {
      noDeadlineCheckbox.disabled = false;
      if (noDeadlineCheckbox.checked) {
        deadlineInput.value = "";
        deadlineInput.disabled = true;
        intervalInput.disabled = false;
      } else {
        deadlineInput.disabled = false;
        intervalInput.value = "";
        intervalInput.disabled = true;
      }
    }
  }

  if (noDeadlineCheckbox && deadlineInput && intervalInput) {
    noDeadlineCheckbox.addEventListener('change', updateDeadlineState);
    deadlineInput.addEventListener('change', updateDeadlineState);
    deadlineInput.addEventListener('input', updateDeadlineState);
    updateDeadlineState();
  }

  // ---------- å®Œæˆä»»å‹™ Modal ----------
  const doneForms = document.querySelectorAll('.done-form');
  const doneModalOverlay = document.getElementById('done-modal-overlay');
  const doneConfirmBtn = document.getElementById('done-confirm-btn');
  const doneCancelBtn = document.getElementById('done-cancel-btn');
  const doneModalText = document.getElementById('done-modal-text');
  let currentDoneForm = null;

  function openDoneModal(title) {
    if (doneModalText) {
      doneModalText.textContent = `æ¨¹æ‡¶æé†’ä½ ï¼šç¢ºå®šè¦æŠŠã€Œ${title}ã€æ¨™è¨˜ç‚ºå·²å®Œæˆå—ï¼Ÿ`;
    }
    doneModalOverlay.style.display = 'flex';
  }
  function closeDoneModal() {
    doneModalOverlay.style.display = 'none';
    currentDoneForm = null;
  }

  doneForms.forEach(form => {
    form.addEventListener('submit', function (e) {
      e.preventDefault();
      const title = this.dataset.title || 'é€™å€‹ä»»å‹™';
      currentDoneForm = this;
      openDoneModal(title);
    });
  });

  if (doneCancelBtn) {
    doneCancelBtn.addEventListener('click', closeDoneModal);
  }
  if (doneConfirmBtn) {
    doneConfirmBtn.addEventListener('click', () => {
      if (currentDoneForm) currentDoneForm.submit();
      closeDoneModal();
    });
  }
  if (doneModalOverlay) {
    doneModalOverlay.addEventListener('click', (e) => {
      if (e.target === doneModalOverlay) closeDoneModal();
    });
  }

  // ---------- åˆªé™¤ä»»å‹™ Modal ----------
  const deleteForms = document.querySelectorAll('.delete-form');
  const deleteModalOverlay = document.getElementById('delete-modal-overlay');
  const deleteConfirmBtn = document.getElementById('delete-confirm-btn');
  const deleteCancelBtn = document.getElementById('delete-cancel-btn');
  const deleteModalText = document.getElementById('delete-modal-text');
  let currentDeleteForm = null;

  function openDeleteModal(title) {
    if (deleteModalText) {
      deleteModalText.textContent =
        `æ¨¹æ‡¶å°è²å•ï¼šçœŸçš„è¦æŠŠã€Œ${title}ã€æ•´å€‹åˆªæ‰å—ï¼Ÿï¼ˆä¹‹å¾Œå°±æ‰¾ä¸åˆ°å›‰ï¼‰`;
    }
    deleteModalOverlay.style.display = 'flex';
  }
  function closeDeleteModal() {
    deleteModalOverlay.style.display = 'none';
    currentDeleteForm = null;
  }

  deleteForms.forEach(form => {
    form.addEventListener('submit', function (e) {
      e.preventDefault();
      const title = this.dataset.title || 'é€™å€‹ä»»å‹™';
      currentDeleteForm = this;
      openDeleteModal(title);
    });
  });

  if (deleteCancelBtn) {
    deleteCancelBtn.addEventListener('click', closeDeleteModal);
  }
  if (deleteConfirmBtn) {
    deleteConfirmBtn.addEventListener('click', () => {
      if (currentDeleteForm) currentDeleteForm.submit();
      closeDeleteModal();
    });
  }
  if (deleteModalOverlay) {
    deleteModalOverlay.addEventListener('click', (e) => {
      if (e.target === deleteModalOverlay) closeDeleteModal();
    });
  }

  // ---------- ä»»å‹™åˆ†é¡ç¯©é¸ & ç©ºæ¸…å–®æç¤º ----------
  const filterButtons = document.querySelectorAll('.filter-btn[data-filter]');
  const taskCards = document.querySelectorAll('.task-card');
  const tasksGrids = document.querySelectorAll('.tasks-grid');
  const emptyHints = document.querySelectorAll('.tasks-empty-hint');

  tasksGrids.forEach(grid => {
    grid.classList.add('three-cols');
  });

  function updateEmptyHint() {
    if (!emptyHints.length) return;
    let anyVisible = false;
    taskCards.forEach(card => {
      if (card.style.display !== 'none') {
        anyVisible = true;
      }
    });
    emptyHints.forEach(hint => {
      hint.style.display = anyVisible ? 'none' : 'block';
    });
  }

  filterButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const filter = btn.dataset.filter || 'all';

      filterButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      taskCards.forEach(card => {
        const category = card.dataset.category || 'other';
        if (filter === 'all' || filter === category) {
          card.style.display = '';
        } else {
          card.style.display = 'none';
        }
      });

      tasksGrids.forEach(grid => {
        grid.classList.remove('two-cols', 'three-cols');
        grid.classList.add('three-cols');
      });

      updateEmptyHint();
    });
  });

  // ---------- å¿ƒéˆé›æ¹¯ ----------
  const lazyQuotes = [
    "èˆ’æœæ˜¯ç•™çµ¦æ­»äººçš„ï¼Œäº¤ä½œæ¥­çš„æ˜¯æ´»äººã€‚ä½ ç¾åœ¨é‚„æ´»è‘—ï¼Œå¿«å»å¯«ã€‚ğŸ§Ÿâ€â™€ï¸",
    "ä½ ä¸æ˜¯æ²’æœ‰æ™‚é–“ï¼Œä½ åªæ˜¯æŠŠæ™‚é–“å…¨éƒ¨æçµ¦äº†æ‰‹æ©Ÿè¢å¹•ã€‚ğŸ“±",
    "å†æ»‘ä¸€ä¸‹æ²’é—œä¿‚å•¦â€”â€”ä½ çš„è…çˆ›åº¦é€™éº¼é«˜ï¼Œä¹Ÿä¸å·®é€™ 5 åˆ†é˜ã€‚ï¼ˆèª¤ï¼‰",
    "å…ˆåš 10 åˆ†é˜å°±å¥½ï¼Œä¸æƒ³åšå†çˆ›å›å»ä¹Ÿå¯ä»¥ã€‚ä½†é€šå¸¸ä½ æœƒåšè¶…éã€‚â±ï¸",
    "å¦‚æœæœªä¾†çš„ä½ å¯ä»¥å›è¨Šæ¯ï¼Œä»–ç¾åœ¨æœƒèªªï¼šæ‹œè¨—å¿«é»é–‹å§‹ï¼Œæˆ‘çœŸçš„å¿«çˆ†æ‰äº†ã€‚ğŸ’¥",
    "æ‹–å»¶çš„ä¸æ˜¯äº‹æƒ…ï¼Œæ˜¯ä½ åŸæœ¬å¯ä»¥å¾ˆè¼•é¬†çš„è‡ªå·±ã€‚çµ¦ä»–ä¸€é»å°Šé‡ã€‚ğŸ¤"
  ];
  function randomQuote() {
    const idx = Math.floor(Math.random() * lazyQuotes.length);
    return lazyQuotes[idx];
  }
  const quoteBackdrop = document.getElementById("quote-backdrop");
  const btnOpenQuote = document.getElementById("open-quote-modal");
  const btnCloseQuote = document.getElementById("quote-close");
  const btnNextQuote = document.getElementById("quote-next");
  const quoteTextEl = document.getElementById("quote-text");

  if (btnOpenQuote && quoteBackdrop) {
    btnOpenQuote.addEventListener("click", () => {
      quoteTextEl.textContent = randomQuote();
      quoteBackdrop.classList.add("show");
    });
  }
  if (btnCloseQuote) {
    btnCloseQuote.addEventListener("click", () => {
      quoteBackdrop.classList.remove("show");
    });
  }
  if (btnNextQuote) {
    btnNextQuote.addEventListener("click", () => {
      quoteTextEl.textContent = randomQuote();
    });
  }
  if (quoteBackdrop) {
    quoteBackdrop.addEventListener("click", (e) => {
      if (e.target === quoteBackdrop) quoteBackdrop.classList.remove("show");
    });
  }
  // ---------- ä½¿ç”¨è€…åç¨±ï¼šé¦–é  + å€‹äºº åŒæ­¥ ----------
  const NAME_KEY = 'rot_user_name';
  const SERVER_OWNER = "{{ owner or '' }}";

  // é¦–é ä¸Šé¢é‚£ä¸€æ’
  const topNameInput = document.getElementById('top-name-input');
  const setUserBtn = document.getElementById('set-user-btn');
  const currentUserLabel = document.getElementById('current-user-label');

  // å€‹äººé é‚£å¼µå¡ç‰‡
  const profileNameInput = document.getElementById('profile-name-input');
  const saveNameBtn = document.getElementById('save-name-btn');
  const displayNameEls = document.querySelectorAll('[data-display-name]');
  const heroSubEl = document.getElementById('hero-sub');
  const personalNoteEl = document.querySelector('.personal-note');

  function getStoredName() {
    const fromLocal = localStorage.getItem(NAME_KEY);
    if (fromLocal && fromLocal.trim()) return fromLocal;
    return SERVER_OWNER;
  }

  function applyNameToUI(name) {
    const trimmed = (name || '').trim();
    const safe = trimmed || 'æœ‹å‹';

    // åŒæ­¥å…©å€‹è¼¸å…¥æ¡†
    if (topNameInput) topNameInput.value = trimmed;
    if (profileNameInput) profileNameInput.value = trimmed;

    // é¦–é å³é‚Šé‚£å¥
    if (currentUserLabel) {
      currentUserLabel.innerHTML =
        `ç›®å‰ä½¿ç”¨è€…ï¼š<span data-display-name>${safe}</span> Â· ä¸‹é¢æ¸…å–®éƒ½æ˜¯ä½ çš„å°ˆå±¬ä»»å‹™ ğŸ¿`;
    }

    // å…¶ä»–éœ€è¦é¡¯ç¤ºåå­—çš„åœ°æ–¹ï¼ˆå€‹äººé  titleã€ä¸‹é¢ä¸€å¥è©±ï¼‰
    displayNameEls.forEach(el => el.textContent = safe);

    // Hero åº•ä¸‹é‚£å¥è©±
    if (heroSubEl) {
      heroSubEl.textContent = trimmed
        ? `${safe}ï¼Œæ¨¹æ‡¶ç›£ç£å“¡ä»Šå¤©æœƒé»˜é»˜ç›¯è‘—ä½ å–”ã€‚`
        : 'æ¨¹æ‡¶ç›£ç£å“¡ä»Šå¤©æœƒé»˜é»˜ç›¯è‘—ä½ å–”ã€‚';
    }

    // å€‹äººé ã€Œç¾åœ¨ç´€éŒ„çš„åå­—æ˜¯...ã€é‚£è¡Œ
    if (personalNoteEl) {
      personalNoteEl.style.display = trimmed ? 'block' : 'none';
    }
  }

  function saveNameToLocal(name) {
    const trimmed = (name || '').trim();
    if (trimmed) {
      localStorage.setItem(NAME_KEY, trimmed);
    } else {
      localStorage.removeItem(NAME_KEY);
    }
  }

  // é€²å…¥é é¢æ™‚ï¼Œå…ˆç”¨ localStorage / server çš„åå­—å¥— UI
  applyNameToUI(getStoredName());

  // é¦–é é‚£é¡†ã€Œåˆ‡æ› / è¨­å®šä½¿ç”¨è€…ã€ï¼š
  // é€å‡º form çš„åŒæ™‚ï¼Œé †ä¾¿æŠŠåå­—è¨˜åœ¨ localStorage
  if (setUserBtn && topNameInput) {
    setUserBtn.addEventListener('click', () => {
      saveNameToLocal(topNameInput.value);
      // ä¸é˜»æ­¢é è¨­è¡Œç‚ºï¼Œè®“è¡¨å–®ç…§å¸¸ POST åˆ° /set_owner
    });
  }

  // å€‹äººé é¢çš„ã€Œå„²å­˜ã€ï¼šåªæ›´æ–° localStorage + ç•«é¢
  if (saveNameBtn && profileNameInput) {
    saveNameBtn.addEventListener('click', () => {
      saveNameToLocal(profileNameInput.value);
      applyNameToUI(profileNameInput.value);
      alert("å·²æ›´æ–°åç¨±ï¼Œä¸‹æ¬¡å›åˆ°é¦–é ä¹Ÿæœƒå¥—ç”¨é€™å€‹åå­—å–”ï¼");
    });
  }

</script>
</body>
</html>
