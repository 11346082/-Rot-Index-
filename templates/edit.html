<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç·¨è¼¯ä»»å‹™ - æ‹–å»¶è…çˆ›æ¸…å–®</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Noto Serif TC', serif;
      margin: 0;
      background: #f3f4f6;
      color: #111827;
    }
    a {
      color: inherit;
      text-decoration: none;
    }

    .wrapper {
      min-height: 100vh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 24px 16px 40px;
    }
    .card {
      width: 100%;
      max-width: 720px;
      background: #ffffff;
      border-radius: 18px;
      padding: 22px 24px 24px;
      box-shadow: 0 10px 24px rgba(15,23,42,0.08);
    }

    .card-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }
    .card-title {
      font-size: 20px;
      margin: 0;
    }
    .card-subtitle {
      font-size: 13px;
      color: #6b7280;
      margin: 0 0 18px;
    }

    label {
      display: block;
      font-size: 13px;
      color: #4b5563;
      margin-bottom: 4px;
    }
    .required-asterisk {
      color: #ef4444;
      font-size: 12px;
      margin-left: 2px;
      position: relative;
      top: -2px;
    }

    input[type="text"],
    input[type="number"],
    input[type="datetime-local"],
    select {
      width: 100%;
      padding: 9px 11px;
      border-radius: 12px;
      border: 1px solid #d1d5db;
      font-size: 14px;
      font-family: 'Noto Serif TC', serif;
    }
    input::placeholder {
      color: #9ca3af;
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      margin-top: 6px;
      color: #4b5563;
    }
    .hint-text {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 3px;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 14px;
    }
    .form-row > div {
      flex: 1;
      min-width: 220px;
    }

    .btn-bar {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 4px;
    }
    button,
    .btn {
      border: none;
      border-radius: 999px;
      padding: 10px 22px;
      font-size: 14px;
      cursor: pointer;
      font-family: 'Noto Serif TC', serif;
      transition: all 0.18s ease;
    }
    .btn-secondary {
      background: #e5e7eb;
      color: #374151;
    }
    .btn-primary {
      background: #4f46e5;
      color: #f9fafb;
    }
    button:hover,
    .btn:hover {
      filter: brightness(1.05);
      box-shadow: 0 4px 10px rgba(15,23,42,0.18);
      transform: translateY(-1px);
    }

    .back-link {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 10px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /* ============== æ‰‹æ©Ÿ RWD èª¿æ•´ ============== */
    @media (max-width: 768px) {
      .wrapper {
        padding: 16px 12px 28px;
      }
      .card {
        padding: 18px 16px 20px;
        border-radius: 16px;
      }
      .card-title {
        font-size: 18px;
      }
      .form-row {
        flex-direction: column;
        gap: 10px;
      }
      .form-row > div {
        min-width: 100%;
      }
      .btn-bar {
        justify-content: space-between;
      }
      button,
      .btn {
        padding: 9px 18px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
<div class="wrapper">
  <div class="card">
    <a href="{{ url_for('index') }}" class="back-link">â† å›åˆ°æ¸…å–®</a>

    <div class="card-title-row">
      <h1 class="card-title">ç·¨è¼¯ä»»å‹™</h1>
    </div>
    <p class="card-subtitle">
      æŠŠå…§å®¹ã€æˆªæ­¢æ™‚é–“æˆ–è…çˆ›ç¨‹åº¦èª¿æ•´åˆ°ä½ ç¾åœ¨è¦ºå¾—æ¯”è¼ƒåˆç†çš„ç‹€æ…‹ã€‚
    </p>

    <form method="post">
      <!-- ä»»å‹™å…§å®¹ -->
      <div class="form-row">
        <div>
          <label for="title">
            ä»»å‹™å…§å®¹<span class="required-asterisk">*</span>
          </label>
          <input
            type="text"
            id="title"
            name="title"
            required
            value="{{ task.title }}"
            placeholder="ä¾‹å¦‚ï¼šç¬¬ 3 å–®å…ƒè‹±æ–‡å–®å­—ã€é›¢æ•£ä½œæ¥­ã€æ´—è¡£æœ">
        </div>
      </div>

      <!-- åˆ†é¡ + ä¸€é–‹å§‹çš„è…çˆ›åº¦ -->
      <div class="form-row">
        <div>
          <label for="category">
            åˆ†é¡<span class="required-asterisk">*</span>
          </label>
          <select id="category" name="category" required>
            <option value="homework" {% if task.category == 'homework' %}selected{% endif %}>ä½œæ¥­ ğŸ“š</option>
            <option value="exam" {% if task.category == 'exam' %}selected{% endif %}>è€ƒè©¦ ğŸ“</option>
            <option value="life" {% if task.category == 'life' %}selected{% endif %}>ç”Ÿæ´» ğŸŒ¿</option>
            <option value="habit" {% if task.category == 'habit' %}selected{% endif %}>ç¿’æ…£ / æ¯å¤©éƒ½è¦åš ğŸ”</option>
            <option value="other" {% if task.category == 'other' %}selected{% endif %}>å…¶ä»– ğŸŒ€</option>
          </select>
        </div>
        <div>
          <label for="initial_rot">
            ä¸€é–‹å§‹çš„è…çˆ›åº¦<span class="required-asterisk">*</span>
          </label>
          <select id="initial_rot" name="initial_rot" required>
            <option value="0"  {% if task.initial_rot == 0 %}selected{% endif %}>0 - å®Œå…¨æ–°é®® ğŸ€</option>
            <option value="30" {% if task.initial_rot == 30 %}selected{% endif %}>30 - å¾®å¾®ç™¼é…µä¸­ ğŸŒ±</option>
            <option value="60" {% if task.initial_rot == 60 %}selected{% endif %}>60 - è…çˆ›å‘³å‡ºä¾†äº† ğŸ¤¢</option>
            <option value="90" {% if task.initial_rot == 90 %}selected{% endif %}>90 - å®Œå…¨çˆ›æ‰äº† ğŸ§Ÿâ€â™‚ï¸</option>
          </select>
        </div>
      </div>

      <!-- æˆªæ­¢æ™‚é–“ / ç„¡æœŸé™å¹¾å¤©ä¸€æ¬¡ -->
      <div class="form-row">
        <div>
          <label for="deadline">æˆªæ­¢æ™‚é–“ï¼ˆå¯é¸ï¼‰</label>
          <input
            type="datetime-local"
            id="deadline"
            name="deadline"
            value="{{ deadline_input }}">
        </div>
        <div>
          <label for="interval_days">ï¼ˆç„¡æœŸé™ï¼‰å¹¾å¤©è¦åšä¸€æ¬¡</label>
          <input
            type="number"
            id="interval_days"
            name="interval_days"
            min="1"
            max="30"
            value="{{ task.interval_days if task.interval_days else '' }}"
            placeholder="ä¾‹å¦‚ 1 æˆ– 3">
          <div class="checkbox-row">
            <input
              type="checkbox"
              id="no_deadline"
              name="no_deadline"
              {% if task.is_routine or not deadline_input %}checked{% endif %}>
            <label for="no_deadline">é€™æ˜¯ç„¡æœŸé™ / èª¿æ•´å‹ä»»å‹™</label>
          </div>
          <div class="hint-text">
            åªå°ã€Œç„¡æœŸé™ / ç¿’æ…£å‹ã€æœ‰ä½œç”¨ï¼Œæ²’å¡«é è¨­ç‚º 1 å¤©ã€‚
          </div>
        </div>
      </div>

      <!-- æŒ‰éˆ• -->
      <div class="btn-bar">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">å–æ¶ˆè¿”å›</a>
        <button type="submit" class="btn-primary">ä¿å­˜ä¿®æ”¹</button>
      </div>
    </form>
  </div>
</div>

<script>
  // å’Œé¦–é ä¸€æ¨£çš„é‚è¼¯ï¼šæœ‰æˆªæ­¢æ™‚é–“å°±é–ä½ã€Œç„¡æœŸé™ã€æ¬„ä½
  const noDeadlineCheckbox = document.getElementById('no_deadline');
  const deadlineInput = document.getElementById('deadline');
  const intervalInput = document.getElementById('interval_days');

  function updateDeadlineState() {
    if (!noDeadlineCheckbox || !deadlineInput || !intervalInput) return;

    const hasDeadline = deadlineInput.value !== "";

    if (hasDeadline) {
      noDeadlineCheckbox.checked = false;
      noDeadlineCheckbox.disabled = true;
      intervalInput.value = "";
      intervalInput.disabled = true;
      deadlineInput.disabled = false;
    } else {
      noDeadlineCheckbox.disabled = false;
      if (noDeadlineCheckbox.checked) {
        deadlineInput.value = "";
        deadlineInput.disabled = true;
        intervalInput.disabled = false;
      } else {
        deadlineInput.disabled = false;
        intervalInput.value = "";
        intervalInput.disabled = true;
      }
    }
  }

  if (noDeadlineCheckbox && deadlineInput && intervalInput) {
    noDeadlineCheckbox.addEventListener('change', updateDeadlineState);
    deadlineInput.addEventListener('change', updateDeadlineState);
    deadlineInput.addEventListener('input', updateDeadlineState);
    // åˆæ¬¡è¼‰å…¥æ™‚ä¹Ÿè·‘ä¸€æ¬¡ï¼Œè®“æ‰‹æ©Ÿç‰ˆä¸€é–‹å§‹ç‹€æ…‹å°±æ­£ç¢º
    updateDeadlineState();
  }
</script>
</body>
</html>
